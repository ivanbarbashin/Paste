<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.cdnfonts.com/css/helvetica-neue-5?styles=103510,103499,103506,103507,103508,103509,103502,103503" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/main.css">
	<link rel="icon" type="image/x-icon" href="assets/img/logo.png">
	<title>PASTE</title>
</head>
<body class="">
	<div class="container">
		<header>
			<a href="help.html" class="base-btn guide-btn">?</a>
			<a href="log.html" class="base-btn login-btn">LOGIN</a>
		</header>
		<main>
			<form class="paste" action="">
				<input type="text" placeholder="Title" class="paste__title">
				<input type="text" placeholder="Your name" class="paste__author">
				<textarea name="" id="" placeholder="Write something or press ‘space’ for AI" class="paste__text"></textarea>
			</form>
			<div id="popupMenu">
				<button class="cursiv">I</button>
				<button class="bold">B</button>
				<button class="underline">U</button>
				<button class="h1-button">H1</button>
				<button class="h2-button">H2</button>
			</div>
		</main>
		<footer>
			<select name="category" id="category-select">
				<option value="Category">Category</option>
				<option value="Note">Note</option>
				<option value="Code">Code</option>
				<option value="Article">Article</option>
			</select>
			<select name="expiration" id="expiration-select">
				<option value="expiration">Expiration</option>
				<option value="1hour">burn after read</option>
				<option value="1hour">an hour</option>
				<option value="1day">a day</option>
				<option value="1week">a week</option>
				<option value="1month">a month</option>
				<option value="1year">a year</option>
			</select>
			<button class="base-btn"><img src="assets/img/edit_together.png" alt="edit_together"></button>
			<button class="base-btn">PUBLISH</button>
		</footer>
	</div>

	<script>
		const textareaItem = document.querySelector('.paste textarea');
		const popupMenu = document.getElementById('popupMenu');

		let selectionStartText = '';
		let selectionEndText = '';
		let selectedText = '';
		
		let beforeSelection = '';
		let afterSelection = '';

		// function to see selected text
		const logSelection = () => {
            selectionStartText = textareaItem.selectionStart;
            selectionEndText = textareaItem.selectionEnd;
            selectedText = textareaItem.value.substring(selectionStartText, selectionEndText);
            
			beforeSelection = textareaItem.value.substring(0, selectionStartText);
            afterSelection = textareaItem.value.substring(selectionEndText);
            

            if (selectedText.length > 0) {
                console.log('Выделенный текст:', selectedText);
				console.log('Невыделенный текст:', beforeSelection, afterSelection);
            }
        };

        textareaItem.addEventListener('select', () => {
            setTimeout(logSelection, 0);
        });


		// popup menu for editing
		const showPopupMenu = (event) => {
			const selectionStart = textareaItem.selectionStart;
            const selectionEnd = textareaItem.selectionEnd;
            const selectedText = textareaItem.value.substring(selectionStart, selectionEnd);

            if (selectedText.length > 0) {
                popupMenu.style.display = 'flex';
            } else {
                popupMenu.style.display = 'none';
            }
        };

        const hidePopupMenu = () => {
            popupMenu.style.display = 'none';
        };

        textareaItem.addEventListener('mouseup', () => {
            setTimeout(showPopupMenu, 0);
        });

        document.addEventListener('click', (event) => {
            if (!textareaItem.contains(event.target) && !popupMenu.contains(event.target)) {
                hidePopupMenu();
				selectionStartText = '';
				selectionEndText = '';
				selectedText = '';
				
				beforeSelection = '';
				afterSelection = '';
            }
        });

		textareaItem.addEventListener('input', function(){
            hidePopupMenu();
			selectionStartText = '';
			selectionEndText = '';
			selectedText = '';
				
			beforeSelection = '';
			afterSelection = '';
        });



		// Buttons to redact
		const cursivButton = document.querySelector('main #popupMenu .cursiv');
		const boldButton = document.querySelector('main #popupMenu .bold');
		const underlineButton = document.querySelector('main #popupMenu .underline');
		const h1Button = document.querySelector('main #popupMenu .h1-button');
		const h2Button = document.querySelector('main #popupMenu .h2-button');
	</script>
</body>
</html>